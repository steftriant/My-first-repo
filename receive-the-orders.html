<!DOCTYPE html>
<html lang="en">
	<head>																																
		<meta charset="UTF-8">																											
		<meta name="viewport" content="width=device-width, initial-scale=1.0">															
		<meta http-equiv="X-UA-Compatible" content="ie=edge">																			
		<title>Receive the orders</title> 																										
	</head>
	<body>
		<form role="form" name="receiveTheOrders" accept-charset="utf-8">
			<script cam-script type="text/form-script">
				var variableManager = camForm.variableManager;
				var selectedProducts = [];

				camForm.on('form-loaded', function() { 		
					console.log('asdasd')												// No any variable has been loaded from the server.
					variableManager.fetchVariable('aggregatedList');
					console.log('rrrr')										// We declare the merged json variable 'aggregatedList' so as to fetch its values.
				});

				camForm.on('variables-fetched', function(t) {												// The merged json variable 'aggregatedList' has been fetched from the server.
					console.log('rrrr1',t,t.variableManager.variables.aggregatedList)
					var aggregatedList = t.variableManager.variables.aggregatedList;
					console.log($scope)
					var selectedProducts = [];
					var total = 0;
					var countProducts = 0;
					for (var key in aggregatedList.value){
						var selectedProductsPerUser = aggregatedList.value[key];
						selectedProductsPerUser.forEach(function(selectedProduct) {
						  	selectedProduct.user = key;
						  	selectedProducts.push(selectedProduct)
						  	total += selectedProduct.Price * selectedProduct.Quantity;
							countProducts += selectedProduct.Quantity;
						});
				    }
				    $scope.total = total;
					$scope.countProducts = countProducts;
					$scope.selectedProducts = selectedProducts;
					//aggregatedList[$scope.task.assignee] = selectedProduct;
					console.log('rrrr2',$scope.selectedProducts)
					//alert(JSON.stringify(selectedProduct))
					//var variableValue = variableManager.variableValue('aggregatedList', aggregatedList);

				});
			</script>
			<h2><b>Λίστα Επιλεγμένων Προϊόντων</b></h2>							 																							
			<style>																																																																																																	
				table.robotCLS td, table.robotCLS th {			
					padding: 2px 5px 2px 5px !important;																																							
					font-size: 13px;
				}
				table.robotCLS textarea {
					width:100%;																						
				}
			</style> 																																																	
			<div>
				<table class="robotCLS" style="width:100%;">																																						
					<thead>
						<tr>
							<th>α/α<br>Είδους</th>
							<th>Τοπικός Διαχειριστής</th>
							<th>Είδος</th>
							<th>Περιγραφή</th>
							<th>Κόστος (€)<br>(με ΦΠΑ)</th>
							<th>URL<br>Ενδεικτικού Αρχείου<br>Προδιαγραφών</th>
							<th>Ποσότητα</th>
							<th>Σύνολο (€)<br>(με ΦΠΑ)</th>
						</tr>			
					</thead>
					<tbody>
						<tr ng-repeat="y in selectedProducts track by $index">
							<td>{{$index+1}}</td>
							<td><input style="width:125px;" type="text" value="{{y.user}}" readonly /></td>
							<td><input style="width:250px;" type="text" value="{{y.Category}}" readonly /></td>
							<td style="width:100% ; padding: 0px 0px 0px 0px"><textarea rows="3" type="text" readonly>{{y.Description}}</textarea></td>
							<td><input style="width:75px;" type="number" value="{{y.Price}}" readonly /></td>
							<td><input style="width:100px;" type="url" value="{{y.Details}}" readonly hidden /><a href="{{y.Details}}" target="_blank">URL Αρχείου</a></td>										
							<td><input type="number" value="{{y.Quantity}}"					
												   	 min="1"
												   	 readonly /></td>																											
							<td><input value="{{y.Price * y.Quantity}}" readonly /></td>																											
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><b>Σύνολο</b></td>
							<td><b><input value="{{countProducts}}" readonly /></b></td>
							<td><b><input value="{{total}}" readonly /></b></td>																																	
						</tr>
					</tbody>
				</table>
			</div>
		</form>
	</body>
</html>			